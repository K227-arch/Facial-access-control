<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Security Incidents</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/records.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css ">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

</head>
<body>
    <!-- NAVBAR -->

   {% include '_navigation.html' %}

  

   

   <main class="main-content">

        <header class="header">
            <div>
                <h1>All Security Incidents</h1>
                <p class="subtitle">Detailed log of all security incidents</p>
            </div>
            <div class="header-right">
                <div class="status">
                <span>System Status: <strong>Active</strong></span>
                <small>Last update: 1 min ago</small>
                </div>
                <div class="profile-icon">
                <i class="bi bi-person-circle"></i>
                </div>
            </div>
        </header>



     
        <div id="icidents-header">
            <a href="/records" class="back-button">
                <i class="fas fa-arrow-left"></i> Back to Records
            </a>

            <div class="preheader">
                <input type="text" id="searchInput" placeholder="Search records..." class="search-bar" />
            </div>

        </div>

     

       <div id="incident-list">
          {% if incidents %}
            {% for incident in incidents %}
            <div class="incident-card {{ incident.status|lower }}">
              <!-- HEADER ROW: title on left, time+badge on right -->
              <div class="incident-header">
                <strong>{{ incident.name|capitalize }}</strong>
                <div class="incident-meta">
                  <span class="incident-time">{{ incident.timestamp.split()[1] }}</span>
                  <span class="badge {{ incident.status|lower }}">{{ incident.status }}</span>
                </div>
              </div>
              <!-- DESCRIPTION -->
              <p class="incident-description">
                {{ incident.description or 'No description provided' }}
              </p>
            </div>
            {% endfor %}
          {% else %}
            <div class="empty-state">
              <i class="fas fa-exclamation-circle"></i>
              <p>No incidents found</p>
            </div>
          {% endif %}
        </div>
        <div class="pagination-controls">
                <button id="prevBtn" disabled>← Previous</button>
                <span id="pageInfo">Page 1 of 1</span>
                <button id="nextBtn">Next →</button>
        </div>
       

    </main>
    <script>

    let count = 0;
    const rowsPerPage = 12;
    let currentPage = 1;
    const icidentList = document.getElementById('incident-list') 
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const pageInfo = document.getElementById('pageInfo');
    const filteredRows = Array.from(icidentList.querySelectorAll('.incident-card'));
    console.log(filteredRows.length);


    function updatePagination() {
        const totalPages = Math.max(1, Math.ceil(filteredRows.length / rowsPerPage));
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage === totalPages;
    }

    function renderPage(page) {
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        filteredRows.forEach(r => (r.style.display = 'none'));
        filteredRows.slice(start, end).forEach(r => (r.style.display = ''));
        updatePagination();
    }

    renderPage(currentPage);

     // Prev / Next
    prevBtn.addEventListener('click', () => {
        if (currentPage > 1) renderPage(--currentPage);
    });
    nextBtn.addEventListener('click', () => {
        renderPage(++currentPage);
    });

    </script>
</body>
</html>